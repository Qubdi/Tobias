[{"name": "loan_count_before_app",
  "description": "loan_count_before_app",
  "calculation_type": "Live",
  "created_by": "Anri",
  "sql_script": "SELECT COUNT(*) AS loan_count_before_app\nFROM loans\nWHERE customer_id = (\n    SELECT customer_id FROM applications WHERE id = :app_id\n)\nAND opened_at < (\n    SELECT created_at FROM applications WHERE id = :app_id\n);"
},

{
  "name": "total_loan_before_app",
  "description": "Total loan amount before application",
  "calculation_type": "Live",
  "created_by": "Anri",
  "sql_script": "SELECT SUM(amount) AS total_loan_before_app\nFROM loans\nWHERE customer_id = (\n    SELECT customer_id FROM applications WHERE id = :app_id\n)\nAND opened_at < (\n    SELECT created_at FROM applications WHERE id = :app_id\n);"
},

  {
  "name": "late_payment_count",
  "description": "Count of late payments before application",
  "calculation_type": "Live",
  "created_by": "Anri",
  "sql_script": "SELECT COUNT(*) AS late_payment_count\nFROM payments\nWHERE customer_id = (\n    SELECT customer_id FROM applications WHERE id = :app_id\n)\nAND paid_at < (SELECT created_at FROM applications WHERE id = :app_id)\nAND days_late > 0;"
}



]